<div class="password-reset-container">
  <form [formGroup]="resetForm" (ngSubmit)="onSubmit()" class="password-reset-form">
    <h2>Restablecer Contraseña</h2>

    <div class="form-field">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Nueva Contraseña</mat-label>
        <input
          matInput
          [type]="hidePassword ? 'password' : 'text'"
          formControlName="password"
          placeholder="Ingresa tu nueva contraseña"
          autocomplete="new-password">
        <button
          mat-icon-button
          matSuffix
          (click)="togglePasswordVisibility()"
          type="button"
          [attr.aria-label]="'Hide password'"
          [attr.aria-pressed]="hidePassword">
          <mat-icon>{{hidePassword ? 'visibility_off' : 'visibility'}}</mat-icon>
        </button>
        <mat-error *ngIf="getPasswordErrors()">{{ getPasswordErrors() }}</mat-error>
      </mat-form-field>
    </div>

    <div class="form-field">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Confirmar Contraseña</mat-label>
        <input
          matInput
          [type]="hideConfirmPassword ? 'password' : 'text'"
          formControlName="confirmPassword"
          placeholder="Confirma tu nueva contraseña"
          autocomplete="new-password">
        <button
          mat-icon-button
          matSuffix
          (click)="toggleConfirmPasswordVisibility()"
          type="button"
          [attr.aria-label]="'Hide password'"
          [attr.aria-pressed]="hideConfirmPassword">
          <mat-icon>{{hideConfirmPassword ? 'visibility_off' : 'visibility'}}</mat-icon>
        </button>
        <mat-error *ngIf="getConfirmPasswordErrors()">{{ getConfirmPasswordErrors() }}</mat-error>
      </mat-form-field>
    </div>

    <!-- Error de contraseñas que no coinciden -->
    <div class="error-message" *ngIf="getPasswordMismatchError()">
      <mat-icon>error</mat-icon>
      <span>{{ getPasswordMismatchError() }}</span>
    </div>

    <!-- Requisitos de contraseña -->
    <div class="password-requirements">
      <h4>Requisitos de contraseña:</h4>
      <ul>
        <li [class.valid]="resetForm.get('password')?.value?.length >= 8">
          <mat-icon>{{ resetForm.get('password')?.value?.length >= 8 ? 'check_circle' : 'radio_button_unchecked' }}</mat-icon>
          Mínimo 8 caracteres
        </li>
        <li [class.valid]="hasUppercase(resetForm.get('password')?.value)">
          <mat-icon>{{ hasUppercase(resetForm.get('password')?.value) ? 'check_circle' : 'radio_button_unchecked' }}</mat-icon>
          Al menos una mayúscula
        </li>
        <li [class.valid]="hasNumber(resetForm.get('password')?.value)">
          <mat-icon>{{ hasNumber(resetForm.get('password')?.value) ? 'check_circle' : 'radio_button_unchecked' }}</mat-icon>
          Al menos un número
        </li>
        <li [class.valid]="resetForm.get('password')?.value && resetForm.get('confirmPassword')?.value && resetForm.get('password')?.value === resetForm.get('confirmPassword')?.value">
          <mat-icon>{{ resetForm.get('password')?.value && resetForm.get('confirmPassword')?.value && resetForm.get('password')?.value === resetForm.get('confirmPassword')?.value ? 'check_circle' : 'radio_button_unchecked' }}</mat-icon>
          Las contraseñas coinciden
        </li>
      </ul>
    </div>

    <div class="form-actions">
      <button
        mat-raised-button
        color="primary"
        type="submit"
        [disabled]="!resetForm.valid || isLoading"
        class="full-width submit-button">
        <mat-icon *ngIf="isLoading" class="loading-icon">hourglass_empty</mat-icon>
        <span *ngIf="!isLoading">Restablecer Contraseña</span>
      </button>
    </div>

    <div class="back-to-login-container">
      <a routerLink="/login" class="back-to-login">
        <mat-icon>arrow_back</mat-icon>
        Volver al inicio de sesión
      </a>
    </div>
  </form>
</div>
